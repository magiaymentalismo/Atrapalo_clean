<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"/>
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="theme-color" content="#000000">
<meta name="format-detection" content="telephone=no">
<meta name="color-scheme" content="dark">
<title>Cartelera — Magia & Teatro</title>

<style>
  :root{
    --bg:#000; --bg2:#090909; --panel:#0d0d0d; --card:#121212;
    --ink:#f7f7f7; --muted:#b9b9b9; --hair:#272727;
    --gold:#d4af37; --green:#22c55e; --orange:#f59e0b; --sold:#6b7280;
    --r:.9rem; --rx:999px; --pad:1rem;
  }
  body{
    margin:0; color:var(--ink);
    background: linear-gradient(180deg, #000, #0b0b0b);
    font:600 16px/1.55 -apple-system, system-ui;
  }
  .wrap{max-width:1040px; margin:0 auto; padding:1rem}

  header{position:sticky; top:0; padding:1rem; background:#000c; backdrop-filter:blur(10px)}
  h1{margin:0 0 .3rem; font:900 25px/1.2 system-ui}
  #meta{color:var(--muted); margin-bottom:.5rem}

  .tabs{display:flex; gap:.6rem; overflow-x:auto; padding-bottom:.4rem}
  .tab{
    padding:.7rem 1rem; background:#161616; border-radius:999px;
    border:1px solid var(--hair); color:var(--ink); font-weight:800;
  }
  .tab.active{background:var(--gold); color:#111}

  .panel{background:#111; padding:1rem; border-radius:.9rem}
  .list{display:flex; flex-direction:column; gap:1rem}

  .item{display:flex; justify-content:space-between; padding:1rem;
        background:#161616; border-radius:.9rem; border:1px solid #272727}

  .date{padding:.55rem .9rem; border-radius:.8rem; background:#0f0f0f; border:1px solid #2c2c2c; font-weight:900}
  .time{padding:.5rem .9rem; border-radius:999px; background:#141414; border:1px solid #2c2c2c}

  .chip{padding:.45rem .85rem; border-radius:999px; font-weight:900}
  .chip.gray{background:#2b2b2b}
  .chip.green{background:var(--green); color:#000}
  .chip.gold{background:var(--gold); color:#000}
  .chip.warn{background:var(--orange); color:#000}
  .chip.sold{background:#555; text-decoration:line-through}

  .meter{width:100%; height:8px; background:#0d0d0d; border:1px solid #2c2c2c; border-radius:6px; overflow:hidden}
  .fill{height:100%; background:linear-gradient(90deg,#198754,var(--gold)); width:0%}

  .meta2{margin-top:.3rem; color:var(--muted); font-size:.85rem}

  .month{margin:1rem 0 .3rem; color:var(--gold); font-weight:900}

  /* ABONO TEATRO badge */
  .abono-chip{
      display:inline-flex; gap:.45rem; align-items:center;
      padding:.42rem .9rem; border-radius:999px;
      font-weight:800; font-size:.8rem; border:1px solid transparent;
      margin-top:.4rem; letter-spacing:.4px;
  }
  .abono-chip .dot{
      width:9px; height:9px; border-radius:999px;
  }
  .abono-chip.ok{background:rgba(22,163,74,.15); border-color:#22c55e; color:#bbf7d0}
  .abono-chip.ok .dot{background:#22c55e}

  .abono-chip.off{background:rgba(220,38,38,.18); border-color:#f87171; color:#fecaca}
  .abono-chip.off .dot{background:#f87171}
</style>
</head>

<body>
<header>
  <div class="wrap">
    <h1>Cartelera — Escalera & Escondido</h1>
    <div id="meta"></div>
    <div id="tabs" class="tabs"></div>
  </div>
</header>

<main class="wrap">
  <section class="panel">
    <div id="list" class="list"></div>
  </section>
</main>

<script id="PAYLOAD" type="application/json">{"generated_at": "2025-11-24T16:43:22.724690+01:00", "eventos": {"Disfruta": {"table": {"headers": ["Fecha", "Hora", "Vendidas", "FechaISO", "Capacidad", "Stock", "Abono"], "rows": [["26 Nov 2025", "00:00", 12, "2025-11-26", 48, 36, null], ["10 Dec 2025", "00:00", 0, "2025-12-10", 48, 48, null], ["17 Dec 2025", "00:00", 0, "2025-12-17", 48, 48, null], ["23 Dec 2025", "00:00", 2, "2025-12-23", 51, 49, null]]}}, "Miedo": {"table": {"headers": ["Fecha", "Hora", "Vendidas", "FechaISO", "Capacidad", "Stock", "Abono"], "rows": [["12 Dec 2025", "00:00", 9, "2025-12-12", 48, 39, null], ["19 Dec 2025", "00:00", 0, "2025-12-19", 48, 48, null], ["22 Dec 2025", "00:00", 5, "2025-12-22", 48, 43, null], ["26 Dec 2025", "00:00", 0, "2025-12-26", 48, 48, null]]}}, "Escondido": {"table": {"headers": ["Fecha", "Hora", "Vendidas", "FechaISO", "Capacidad", "Stock", "Abono"], "rows": [["12 Dec 2025", "00:00", 2, "2025-12-12", 60, 58, "agotado"], ["13 Dec 2025", "00:00", 0, "2025-12-13", 0, 0, "agotado"], ["14 Dec 2025", "00:00", 10, "2025-12-14", 60, 50, "agotado"], ["21 Dec 2025", "00:00", 16, "2025-12-21", 35, 19, "agotado"], ["27 Dec 2025", "00:00", 0, "2025-12-27", 30, 30, "agotado"], ["28 Dec 2025", "00:00", 8, "2025-12-28", 35, 27, "agotado"], ["10 Jan 2026", "00:00", 0, "2026-01-10", 20, 20, "agotado"], ["17 Jan 2026", "00:00", 0, "2026-01-17", 20, 20, "agotado"], ["24 Jan 2026", "00:00", 0, "2026-01-24", 20, 20, "agotado"], ["31 Jan 2026", "00:00", 0, "2026-01-31", 20, 20, "agotado"], ["14 Feb 2026", "00:00", 0, "2026-02-14", 20, 20, "agotado"], ["28 Feb 2026", "00:00", 0, "2026-02-28", 20, 20, "agotado"]]}}}}</script>
<script>
const payload = JSON.parse(document.getElementById("PAYLOAD").textContent);
const eventos = payload.eventos || {};

const gen = new Date(payload.generated_at);
document.getElementById("meta").textContent =
  "Generado: " + gen.toLocaleString("es-ES");

let active = Object.keys(eventos)[0] || null;

const tabsEl = document.getElementById("tabs");
for (const sala of Object.keys(eventos)){
  const rows = eventos[sala].table.rows.length;
  const b = document.createElement("button");
  b.className = "tab" + (sala===active?" active":"");
  b.textContent = `${sala} (${rows})`;
  b.onclick = ()=>{ active=sala; updateTabs(); render(); };
  tabsEl.appendChild(b);
}

function updateTabs(){
  document.querySelectorAll(".tab").forEach(t=>{
    t.classList.toggle("active",t.textContent.startsWith(active));
  });
}

function parseRow(r){ return {
  fecha_label:r[0], hora:r[1], vendidas:r[2],
  fecha_iso:r[3], cap:r[4], stock:r[5], abono:r[6]
}; }

const DAYS=["Dom","Lun","Mar","Mié","Jue","Vie","Sáb"];
function dayName(f){ return DAYS[new Date(f+'T00:00:00').getDay()] }
function render(){
  if(!active) return;
  const list = document.getElementById("list");
  list.innerHTML = "";

  let rows = eventos[active].table.rows.map(parseRow);
  rows.sort((a,b)=> (a.fecha_iso + a.hora).localeCompare(b.fecha_iso + b.hora));

  let currentMonth = "";
  for (const x of rows){
    const d = new Date(x.fecha_iso + "T00:00:00");
    const monthKey = d.getFullYear()+"-"+String(d.getMonth()+1).padStart(2,"0");
    const monthLabel = d.toLocaleDateString("es-ES",{month:"long",year:"numeric"});
    if(monthKey!==currentMonth){
      currentMonth=monthKey;
      list.insertAdjacentHTML("beforeend",`<h3 class="month">${monthLabel}</h3>`);
    }

    const fecha = `${x.fecha_label} (${dayName(x.fecha_iso)})`;

    let chipClass="chip gray";
    if(x.vendidas>=1) chipClass="chip green";
    if(x.vendidas>=10) chipClass="chip gold";
    if(x.stock===0) chipClass="chip sold";

    let abonoHTML="";
    if (x.abono==="venta"){
      abonoHTML = `
      <div class="abono-chip ok">
        <span class="dot"></span>
        <span>Abono Teatro · SIGUEN EN VENTA</span>
      </div>`;
    } else if (x.abono==="agotado"){
      abonoHTML = `
      <div class="abono-chip off">
        <span class="dot"></span>
        <span>Abono Teatro · AGOTADO</span>
      </div>`;
    }

    list.insertAdjacentHTML("beforeend",`
      <div class="item">
        <div class="left">
          <div class="date">${fecha}</div>
          <div class="time">${x.hora}</div>
        </div>

        <div style="min-width:220px; text-align:right">
          <span class="${chipClass}">Vendidas: <b>${x.vendidas}</b></span>
          ${abonoHTML}
        </div>
      </div>
    `);
  }
}

if(active) render();
</script>
</body>
</html>
